name: Catbox Pro Uploader

on:
  workflow_dispatch:
    inputs:
      video_url:
        description: 'ุถุน ุฑุงุจุท ุงูููุทุน ููุง'
        required: true
      file_name:
        description: 'ุงูุชุจ ุงุณู ุงูููุทุน'
        required: true

jobs:
  upload:
    runs-on: ubuntu-latest
    steps:
      - name: Transfer Video
        run: |
          # 1. ุชูุธูู ุงูุงุณู ูู ุงููุณุงูุงุช ูุฃู ุฑููุฒ ุบุฑูุจุฉ (ูุถูุงู ูุฌุงุญ ุงูุฑูุน)
          # ุณูุชู ุญุฐู .mp4 ูู ูุชุจุชูุง ูุฅุถุงูุชูุง ุจุดูู ุตุญูุญ
          CLEAN_NAME=$(echo "${{ github.event.inputs.file_name }}" | sed 's/\.mp4//g' | tr -cd '[:alnum:]_ ')
          FINAL_FILE=$(echo "$CLEAN_NAME" | tr ' ' '_').mp4

          echo "๐ ุฌุงุฑู ูุนุงูุฌุฉ ุงูููู ุจุงุณู: $FINAL_FILE"

          # 2. ุชุญููู ุงูููุทุน (ุงุณุชุฎุฏุงู -k ูุชุฌุงูุฒ ุฎุทุฃ SSL certificate problem)
          echo "โฌ๏ธ ุฌุงุฑู ุชุญููู ุงูููุทุน ูู ุงูุณูุฑูุฑ..."
          curl -kL "${{ github.event.inputs.video_url }}" -o "$FINAL_FILE"

          # ุงูุชุฃูุฏ ูู ุฃู ุงูููู ุชู ุชุญูููู ูุนููุงู ูููุณ ูุงุฑุบุงู
          if [ ! -s "$FINAL_FILE" ]; then
            echo "โ ุฎุทุฃ: ูุดู ุชุญููู ุงูููู ุฃู ุงูุฑุงุจุท ุบูุฑ ุตุงูุญ"
            exit 1
          fi

          # 3. ุงูุฑูุน ูู Catbox (ุงุณุชุฎุฏุงู -k ุฃูุถุงู ูุถูุงู ุงูุฃูุงู)
          echo "๐ค ุฌุงุฑู ุงูุฑูุน ุฅูู Catbox..."
          # ุณุญุจ ุงูุฑุงุจุท ุงููุจุงุดุฑ ูุชุฎุฒููู ูู ูุชุบูุฑ
          DIRECT_URL=$(curl -k -F "reqtype=fileupload" -F "fileToUpload=@$FINAL_FILE" https://catbox.moe/user/api.php)

          # 4. ุงููุชูุฌุฉ ุงูููุงุฆูุฉ ุงูุตุงููุฉ
          echo "--------------------------------------------------"
          echo "โ ุชู ุงูุฑูุน ุจูุฌุงุญ ูุง ุจุทู!"
          echo "๐ ุงูุฑุงุจุท ุงููุจุงุดุฑ ุงูุฎุงุต ุจู ูู:"
          echo "$DIRECT_URL"
          echo "--------------------------------------------------"
